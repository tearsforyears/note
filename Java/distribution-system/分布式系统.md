# 分布式系统

---

所谓的分布式系统就是 应用集群之上编写能调用集群各个组件能力的系统 不同于单机处理 利用软件实时提升性能完成计算存储的系统 是分而治之思想的体现

分布式系统的一个重要实现是微服务,微服务是以服务为单独的系统去进行拆分再由其他组件来进行联合调度.



## 构建分布式系统的原因

---

高并发问题 解耦合 高可用 高性能



## 分布式服务需要解决的技术问题

---

分布式会话,分布式锁,分布式事务,RPC

分布式搜索,分布式缓存,分布式消息队列。

统一配置中心,分布式存储,数据库分库分表,限流、熔断、降级等。

其中缓存机制则是由redis可以解决的



## 构建分布式服务的基本思路

---

分布式服务即是微服务,指的是一种服务拆分方式,其服务的划分会直接影响到系统的性能,不同的微服务系统根据不同的业务而定而非一成不变的系统.

微服务就是一种分布式的实现思路,其不同服务可能持有不同的数据库,对于服务的拆分极为重要,但是拆分也是相对而言的,不好的设计可能会浪费掉系统性能,比如交易系统拆分成订单服务,投标服务,转让服务等等.

### 服务拆分思路

**水平拆分**: 顾名思义 通过添加服务数量直接实现系统级请求的分流(负载均衡) 一般针对于无状态的服务,比如swarm集群中的replicas,nginx的轮询代理

**垂直拆分**: 只对业务进行拆分 不要让所有业务都运行在同一台机器上 单独的模块以单独的处理机单独的数据库去处理(分表或者使用数据库集群) 则不同模块之间的调用通过RPC框架实现(自己实现也可) 

除了上面两种拆分方法之外,在垂直划分中,我们如果要做各数据库的**联合查询**则会有以下三种方向.

1.  严格按照微服务的拆分思路,各微服务的数据库独立,需要展示数据时调用各个微服务的接口来获取
2.  将某一类业务高度相关的表放在同一数据库中,不是特别紧密的服务按照微服务拆分
3.  数据库严格按照微服务来拆分,然后一些高并发数据,实时性很强的数据同步到Nosql数据库中,在同步的过程中



## 解决分布式系统构建的技术

---

-   存储技术: Hadoop HDFS
-   计算技术: Hadoop MapReduce Spark Storm(流式计算) Flink
-   数据仓库: hive
-   PRC: dubbo SpringCloud
-   消息队列: RabbitMQ RocketMQ kalfka
-   分布式缓存: redis
-   分布式协调服务: zookeeper
-   分布式**资源**调度: yarn
-   分布式服务: SpringCloud
-   分布式全局检索: ElasticSearch
-   日志: logstash
-   基础容器: docker

这里说明在zookeeper和yarn两种技术,我们知道在分布式系统中,有若干机制共同维护CAP保证分布式系统的正常运作,yarn和zookeeper都是保证正常运作的两种机制,互补而互不影响.yarn擅长资源(cpu 内存)分配,主要负责资源的同一管理和分配.其主要把JobTracker和TaskTracker的职责更加明细了负责调度Job和分配资源.zookeeper提供配置维护,域名服务,分布式同步(分布式锁),选举,队列的接口等.和yarn共同协作完成hadoop生态的系统.zookeeper也多用在分布式服务上.



## CAP定理

---

在计算机科学中, CAP定理（CAP theorem）, 又被称作 布鲁尔定理（Brewer's theorem）, 它指出对于一个分布式计算系统来说，不可能同时满足以下三点:

-   **一致性(Consistency)** (所有节点在同一时间具有相同的数据)
-   **可用性(Availability)** (保证每个请求不管成功或者失败都有响应)
-   **分隔容忍(Partition tolerance)** (系统中任意信息的丢失或失败不会影响系统的继续运作)

一致性是最基本的分布式系统的内容,各个协议的实现区别仅在于同一时间的响应的优先级,可用性自然不必多说,是系统服务长期稳定运作和宕机时候的处理,而分割容忍则是类似熔断器在集群中的地位.



---

## 分布式协议

分布式协议包括选举以及一些协同的过程下面是常用的三种协议.为什么分布式集群得是奇数个和选举有很大的关系.

-   Paxos: google的分布式锁系统应用了该协议,zookeeper也使用了该协议
-   Raft: docker-swarm
-   Zab: zookeeper



---

## 分布式锁

